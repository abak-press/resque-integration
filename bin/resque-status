#!/usr/bin/env ruby
# coding: utf-8

# Скрипт для мониторинга состояния resque

require 'rubygems'

%w(oj yajl-ruby json gson).each do |library|
  begin
    gem(library) and break
  rescue Gem::LoadError
    # ignore, go to next adapter
  end
end

require 'resque'
require 'redis'
require 'resque/integration/configuration'

paths  = File.join(Dir.pwd, 'config', 'resque.yml'),
         File.join(Dir.pwd, 'config', 'resque.local.yml')

config = Resque::Integration::Configuration.new(*paths)
redis = config.redis

Resque.redis = Redis.new(redis)
Resque.redis.namespace = redis[:namespace]

info = Resque.info
key = (ARGV.shift || :pending).to_sym

if info.key?(key)
  puts info[key]
else
  $stderr.puts "Unknown key. Should be one of the [#{info.keys.join(', ')}]"
end